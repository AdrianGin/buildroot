From 05477940a04bf02da35e5aee36de16aae965892b Mon Sep 17 00:00:00 2001
From: "james.lin" <james.lin@rock-chips.com>
Date: Thu, 19 Apr 2018 16:25:26 +0800
Subject: [PATCH] set default audiosink as alsasink and not provide-clock

Signed-off-by: james.lin <james.lin@rock-chips.com>
---
 src/plugins/gstreamer/mediaplayer/qgstreamerplayersession.cpp | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/plugins/gstreamer/mediaplayer/qgstreamerplayersession.cpp b/src/plugins/gstreamer/mediaplayer/qgstreamerplayersession.cpp
index 889456e..6f95777 100755
--- a/src/plugins/gstreamer/mediaplayer/qgstreamerplayersession.cpp
+++ b/src/plugins/gstreamer/mediaplayer/qgstreamerplayersession.cpp
@@ -161,7 +161,10 @@ QGstreamerPlayerSession::QGstreamerPlayerSession(QObject *parent)
         g_object_set(G_OBJECT(m_playbin), "flags", flags, NULL);
 
         const QByteArray envAudioSink = qgetenv("QT_GSTREAMER_PLAYBIN_AUDIOSINK");
-        GstElement *audioSink = gst_element_factory_make(envAudioSink.isEmpty() ? "autoaudiosink" : envAudioSink, "audiosink");
+        GstElement *audioSink = gst_element_factory_make(envAudioSink.isEmpty() ? "alsasink" : envAudioSink, "audiosink");
+        if (g_object_class_find_property(G_OBJECT_GET_CLASS(audioSink), "provide-clock") != 0)
+          g_object_set(G_OBJECT(audioSink), "provide-clock", FALSE, NULL);
+
         if (audioSink) {
             if (usePlaybinVolume()) {
                 m_audioSink = audioSink;
@@ -973,7 +976,7 @@ bool QGstreamerPlayerSession::seek(qint64 ms)
         bool isSeeking = gst_element_seek(m_playbin,
                                           m_playbackRate,
                                           GST_FORMAT_TIME,
-                                          GstSeekFlags(GST_SEEK_FLAG_FLUSH  | direct_flag),
+                                          GstSeekFlags(GST_SEEK_FLAG_FLUSH  | GST_SEEK_FLAG_KEY_UNIT | direct_flag),
                                           GST_SEEK_TYPE_SET,
                                           position,
                                           GST_SEEK_TYPE_NONE,
-- 
2.7.4

